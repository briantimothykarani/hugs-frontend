import{r as t,j as e,L as d}from"./index-QLpKP0Lq.js";import{a as f}from"./index-ngrFHoWO.js";import{g}from"./getImageUrl-D6kr0RYg.js";const j=()=>{const[s,a]=t.useState(null);return t.useEffect(()=>{(async()=>{try{const l=await f.get("http://127.0.0.1:8000/api/current_user/",{headers:{Authorization:`Bearer ${localStorage.getItem("access")}`}});a(l.data)}catch(l){console.error("Failed to fetch current user:",l)}})()},[]),e.jsxs("nav",{className:"h-screen w-64 bg-gray-900 text-white flex flex-col shadow-lg",children:[s&&e.jsxs("div",{className:"p-4 border-b border-gray-800 flex items-center space-x-3",children:[e.jsx("img",{src:g(s.profile_pic),alt:s.username,className:"w-12 h-12 rounded-full object-cover"}),e.jsx("p",{className:"font-semibold",children:s.username})]}),e.jsx("div",{className:"text-2xl font-bold p-6 border-b border-gray-700",children:"Hugs"}),e.jsxs("ul",{className:"flex flex-col flex-grow",children:[e.jsx("li",{className:"hover:bg-gray-700",children:e.jsx(d,{to:"/home/id",className:"block px-6 py-4 border-l-4 border-transparent hover:border-purple-600 transition",children:"Home"})}),s&&e.jsx("li",{className:"hover:bg-gray-700",children:e.jsx(d,{to:`/read/${s.id}`,className:"block px-6 py-4 border-l-4 border-transparent hover:border-purple-600 transition",children:"Profile"})}),e.jsx("li",{className:"hover:bg-gray-700",children:e.jsx(d,{to:"/settings",className:"block px-6 py-4 border-l-4 border-transparent hover:border-purple-600 transition",children:"Settings"})}),e.jsx("li",{className:"hover:bg-gray-700",children:e.jsx(d,{to:"/g-a-c",className:"block px-6 py-4 border-l-4 border-transparent hover:border-purple-600 transition",children:"Get help"})})]})]})},w=({currentUser:s,otherUser:a})=>{const[c,l]=t.useState(""),[i,u]=t.useState([]),x=t.useRef(null),p=t.useRef(null),h=s<a?`${s}_${a}`:`${a}_${s}`;t.useEffect(()=>{const r=new WebSocket(`ws://localhost:8000/ws/chat/${h}/`);return x.current=r,r.onopen=()=>{console.log("WebSocket connected.")},r.onmessage=n=>{const o=JSON.parse(n.data);o.type==="chat"&&u(m=>[...m,{message:o.message,sender:o.sender}])},r.onerror=n=>{console.error("WebSocket error:",n)},r.onclose=()=>{console.warn("WebSocket closed.")},()=>{r.close()}},[h]),t.useEffect(()=>{var r;(r=p.current)==null||r.scrollIntoView({behavior:"smooth"})},[i]);const b=()=>{const r=x.current;c.trim()&&r&&r.readyState===WebSocket.OPEN&&(r.send(JSON.stringify({message:c,sender:s})),l(""))};return e.jsxs("div",{className:"flex h-screen bg-gray-950 text-white",children:[e.jsx(j,{}),e.jsxs("div",{className:"flex flex-col flex-1 h-full max-w-4xl mx-auto bg-black border border-purple-800 rounded-lg shadow-xl overflow-hidden",children:[e.jsxs("header",{className:"p-4 border-b border-purple-700 text-xl font-bold text-purple-400 text-center",children:["Chat with ",a]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 scrollbar-thin scrollbar-thumb-purple-600 scrollbar-track-black",children:[i.length===0?e.jsx("p",{className:"text-center text-gray-400",children:"No messages yet..."}):i.map((r,n)=>{const o=r.sender===s;return e.jsxs("div",{className:`max-w-xs break-words px-4 py-2 rounded-md ${o?"bg-purple-700 text-white self-end":"bg-blue-900 text-white self-start"}`,style:{alignSelf:o?"flex-end":"flex-start"},children:[e.jsx("div",{className:"text-sm font-semibold",children:o?"You":r.sender}),e.jsx("div",{children:r.message})]},n)}),e.jsx("div",{ref:p})]}),e.jsxs("footer",{className:"flex border-t border-purple-700 p-4 gap-2",children:[e.jsx("input",{type:"text",placeholder:"What's on  your mind...",value:c,onChange:r=>l(r.target.value),onKeyDown:r=>r.key==="Enter"&&b(),className:"flex-1 bg-gray-900 rounded-l-md px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-600"}),e.jsx("button",{onClick:b,className:"bg-purple-600 hover:bg-purple-700 rounded-r-md px-6 font-semibold transition cursor-pointer",children:"Send"})]})]})]})};export{w as default};
